{% from '/__macros__/speeds.jinja' import apply_speed_limits -%}
; tpre{{ tool.id }}.g
; called before tool {{ tool.id }} is selected

;Unlock Coupler
M98 P"/macros/Coupler - Unlock"

{% set rounded_Y = (tool.park.Y // 20) * 20 -%}

;Move to location
G1 X{{ tool.park.X }} Y{{ rounded_Y - 40 }} F50000

;Move in
G1 X{{ tool.park.X }} Y{{ rounded_Y - 10 }} F50000


M913 X30 Y30 ; Set the motor current to 30%

;Collect
G1 X{{ tool.park.X }} Y{{ tool.park.Y }} F2500


;Close Coupler
M98 P"/macros/Coupler - Lock"

;WARNING! WARNING! WARNING! WARNING! WARNING! WARNING! WARNING! WARNING! WARNING! WARNING! WARNING! WARNING!
;if you are using non-standard length hotends ensure the bed is lowered enough BEFORE undocking the tool!
G91
G1 Z{{ -2 * tool.offsets.Z }} F1000
G90

M913 X100 Y100 ; Restore the motor current

{{ apply_speed_limits(tool.speed_limits) if 'speed_limits' in tool }}

;Move Out
G1 X{{ tool.park.X }} Y{{ rounded_Y - 90 }} F4000