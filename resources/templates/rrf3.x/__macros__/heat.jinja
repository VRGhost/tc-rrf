; Sets 'out_var' to true if the currently active heater can extrude filament
{% macro is_hot_enough_to_extrude(out_var) %}

; ------ is_hot_enough_to_extrude({{out_var}})

{% set cur_nozzle_idx = py.unique_var('cur_nozzle_idx') -%}
{% set cur_nozzle_temp = py.unique_var('cur_nozzle_temp') -%}
{% set idx = py.unique_var('idx') -%}

var {{ cur_nozzle_idx }} = (state.currentTool >= 0) ? tools[state.currentTool].filamentExtruder : -1
var {{ cur_nozzle_temp }} = (cur_nozzle_idx >= 0) ? heat.heaters[var.{{ cur_nozzle_idx }}].current : -273

echo "T=" ^ var.{{ cur_nozzle_temp }} ^ "H=" ^ heat.coldExtrudeTemperature
; Allow some cooldown (just in case)
set {{out_var}} = (var.{{ cur_nozzle_temp }} - 5) > heat.coldExtrudeTemperature ? 1 : 0

; ------ is_hot_enough_to_extrude() END

{% endmacro %}