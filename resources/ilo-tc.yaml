---
templates_root: ./rrf3.x/
variables:
  # 'render-global vars'
  extra_settings:
    M566:  # Set maximum instantaneous speed changes (mm/min)
      X: 400
      Y: 400
      Z: 8
      C: 2
      E: [2, 2, 2, 2]
      A: 2
      B: 2
    M203:  # Set maximum speeds (mm/min)
      X: 35000
      Y: 35000
      Z: 1200
      C: 5000
      E: [5000, 5000, 5000, 5000]
      A: 5000
      B: 5000
    M201: #  Set accelerations (mm/s^2)
      X: 6000
      Y: 6000
      Z: 400
      C: 500
      E: [2500, 2500, 2500, 2500]
      A: 500
      B: 500
    M207: # Set retract length
      S: 10 # positive length to retract, in mm
      R: -0.6 # positive or negative additional length to un-retract, in mm, default zero
      F: 2400 # retraction feedrate, in mm/min
  z_probe:
    extra_settings:
      M558: # Set Z probe type to switch, the axes for which it is used and the dive height + speeds
        P: 8
        C: zstop
        H: 3
        F: 360
        I: 0
        T: 20000
      G31: # Set Z probe trigger value, offset and trigger height
        P: 200
        X: 0
        Y: 0
        Z: 0
  motors:
    X:
      steps: 100 # steps/mm
    Y:
      steps: 100
    Z:
      steps: 800
    C:
      steps: 91.022
      reversed: true
    E0: &direct_hemera_extrude_motor
      steps: 409 # direct_hemera_esteps
      reversed: false # Motor direction
    E1: *direct_hemera_extrude_motor
    E2: &bowden_hemera_extrude_motor
      steps: 392
      reversed: false
    E3: *bowden_hemera_extrude_motor
    # Brushes
    A: &brush_motor
      steps: 400
      reversed: false
    B: *brush_motor
  axis:
    # Machine axis set up
    X:
      index: 0 # Axis index in move.axes array
      min: -29.6
      width: 363.5
    Y:
      index: 1
      min: -46.8
      width: 292
    Z:
      index: 2
      min: 0
      width: 290
    C: # Carriage
      index: 5
      min: -45
      width: 405
    # Brushes
    A: &brush_axis_a
      index: 3
      min: -11
      width: 30
    B: &brush_axis_b
      index: 4
      min: -8.3
      width: 30
  tools:
    # Tool infos
    T0: &tool0
      id: 0
      fan: 2 # Fan number
      offsets:
        X: 20.53
        Y: 44.24
        Z: -5.148
      park:
        # X/Y location of the tools' parking position
        X: -7.4
        Y: 226.3
      extra_settings: &hemera_direct_extra_settings
        M566: # maximum instantaneous speed changes (mm/min)
          X: 300
          Y: 300
        M201: #  Set accelerations (mm/s^2)
          X: 4000
          Y: 4000
        M207: # Set retract length
          S: 0.25 # positive length to retract, in mm
          R: -0.01
          F: 2700 # retraction feedrate, in mm/min (45 mm / s)
    T1: &tool1
      id: 1
      fan: 4
      offsets:
        X: 20.48
        Y: 43.93
        Z: -5.25
      park:
        X: 81.4
        Y: 226.55
      extra_settings: *hemera_direct_extra_settings
    T2: &tool2
      id: 2
      fan: 6
      offsets:
        X: -8.2
        Y: 39.5
        Z: -4.638
      park:
        X: 218.2
        Y: 242
      extra_settings: &hemera_bowden_extra_settings
        M566: # maximum instantaneous speed changes (mm/min)
          X: 300
          Y: 300
        M201: #  Set accelerations (mm/s^2)
          X: 4000
          Y: 4000
        M207: # Set retract length
          S: 10 # positive length to retract, in mm
          F: 2000 # retraction feedrate, in mm/min (45 mm / s)
    T3: &tool3
      id: 3
      fan: 8
      offsets:
        X: -8.16
        Y: 39.58
        Z: -4.55
      park:
        X: 308.6
        Y: 241.5
      extra_settings: *hemera_bowden_extra_settings
  bed:
    width: 300
    depth: 200
    # Legal (automated) move limits
    X:
      min: 4
      max: 335
    Y:
      min: 0
      max: 200
  brushes:
    right: &right_brush
      x_max: 328.5
      width: 6
      y_min: 128
      depth: 33
    left: &left_brush
      x_max: -19
      width: 6
      y_min: 128
      depth: 33
  filament_overrides:
    PET:
      0.4: # this must be float!
        extrude_factor: 0.93
      0.8:
        extrude_factor: 0.6
    PLA:
      0.4:
        extrude_factor: 0.89
      0.6:
        extrude_factor: 0.87
output_root: ./ilo-tc
render:
  # Output specs
  - output:
      directory: gcodes # Name of the OUTPUT directory files will be saved to
    input:
      directory: ./gcodes
      files: ["**:**"] # <input fname>:<output fname> (one star - non-recursice, two stars - recursive)
    variables: {}
  - output:
      directory: macros # Name of the OUTPUT directory files will be saved to
    input:
      directory: ./macros
      files: ["**:**"]
    variables: {}
  - output:
      directory: sys # Name of the OUTPUT directory files will be saved to
    input:
      directory: ./sys
      files: ["**:**"]
    variables: {}

  # Tool scripts
  - output: # T0
      directory: sys
    input:
      directory: ./__templates__
      files:
        - tfreeX.jinja:tfree0.g
        - tpostX.jinja:tpost0.g
        - tpreX.jinja:tpre0.g
    variables:
      tool: *tool0
  - output: # T1
      directory: sys
    input:
      directory: ./__templates__
      files:
        - tfreeX.jinja:tfree1.g
        - tpostX.jinja:tpost1.g
        - tpreX.jinja:tpre1.g
    variables:
      tool: *tool1
  - output: # T2
      directory: sys
    input:
      directory: ./__templates__
      files:
        - tfreeX.jinja:tfree2.g
        - tpostX.jinja:tpost2.g
        - tpreX.jinja:tpre2.g
    variables:
      tool: *tool2
  - output: # T3
      directory: sys
    input:
      directory: ./__templates__
      files:
        - tfreeX.jinja:tfree3.g
        - tpostX.jinja:tpost3.g
        - tpreX.jinja:tpre3.g
    variables:
      tool: *tool3
  # brush routines
  - output:
      directory: sys/
    input:
      directory: ./__templates__
      files:
        - home_brush.jinja:homea.g
    variables:
      letter: A
      axis: *brush_axis_a
  - output:
      directory: sys/
    input:
      directory: ./__templates__
      files:
        - home_brush.jinja:homeb.g
    variables:
      letter: B
      axis: *brush_axis_b

  - output: # brush right
      directory: sys/usr/brushes
    input:
      directory: ./__templates__
      files:
        - brushX.jinja:right.g
    variables:
      brush: *right_brush
  - output: # brush left
      directory: sys/usr/brushes
    input:
      directory: ./__templates__
      files:
        - brushX.jinja:left.g
    variables:
      brush: *left_brush