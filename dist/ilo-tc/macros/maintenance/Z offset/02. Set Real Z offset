

if state.currentTool >= 0
    abort "No tool must be equipped"

if move.axes[2].userPosition < 30
    G1 Z30 F500 ; Move back a little

if !exists(global.measured_z_height)
    global measured_z_height = 0

G30 S-1
; Move back a little


; ---- rel_move(None, None, 10, 500, G1)
G91
G1 F500 Z10
G90
; ---- rel_move() END

G30 S-1 ; try again

set global.measured_z_height = move.axes[2].userPosition
var zProbeTriggerHeight = sensors.probes[0].triggerHeight

echo "Saved base Z height of " ^ global.measured_z_height ^ "mm (Real object height: "^ (global.measured_z_height - var.zProbeTriggerHeight) ^"mm)"



; ---- rel_move(None, None, 50, 500, G1)
G91
G1 F500 Z50
G90
; ---- rel_move() END
